<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>US County Map with D3</title>
  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <style>
    body { margin:0; }
    svg { display:block; width:100vw; height:100vh; }
    .county { stroke:#fff; stroke-width:0.2; }
  </style>
</head>
<body>
  <svg></svg>
  <script>
  // 1) Projection & path
  const projection = d3.geoAlbersUsa();
  const path = d3.geoPath(projection);

  // 2) Color scale
  const color = d3.scaleOrdinal()
    .domain(['Taken','Open'])
    .range(['#e31a1c','#31a354']);

  // 3) Load both county geometries and your assignment data
  Promise.all([
    d3.json('https://cdn.jsdelivr.net/npm/us-atlas@3/counties-10m.json'),
    d3.json('https://script.google.com/macros/s/.../exec?func=getAssignments')
  ]).then(([us, assignments]) => {
    // convert TopoJSON â†’ GeoJSON
    const counties = topojson.feature(us, us.objects.counties).features;

    // build a lookup by "state|county"
    const lookup = {};
    assignments.forEach(d => {
      const k = d.state.toLowerCase() + '|' + 
                d.county.toLowerCase().replace(' county','');
      lookup[k] = 'Taken';
    });

    // 4) Draw
    d3.select('svg')
      .selectAll('path')
      .data(counties)
      .enter()
      .append('path')
        .attr('class','county')
        .attr('d', path)
        .attr('fill', d => {
          // your TopoJSON has a numeric id, but you can map it to state/county names
          const props = d.properties;
          const key = props.state.toLowerCase() + '|' + 
                      props.name.toLowerCase().replace(' county','');
          return lookup[key] ? color('Taken') : color('Open');
        })
      .on('click', d => {
        const props = d.properties;
        const key = props.state.toLowerCase() + '|' + 
                    props.name.toLowerCase().replace(' county','');
        if (lookup[key]) {
          const rec = assignments.find(a => 
            a.state.toLowerCase() === props.state.toLowerCase() &&
            a.county.toLowerCase().replace(' county','') === props.name.toLowerCase()
          );
          alert(`${rec.county}, ${rec.state}\nLink: ${rec.link}`);
        }
      });
  });
  </script>
</body>
</html>
